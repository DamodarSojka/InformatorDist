moment.locale("pl");var app=angular.module("informatorApp",["ngAnimate","firebase","pascalprecht.translate","angularytics","ngMaterial","ngMessages","duScroll","ui.router","ngDialog"]).config(["$locationProvider",function(a){a.hashPrefix("!")}]).config(["$stateProvider","$urlRouterProvider","$urlMatcherFactoryProvider","MOMENT_URL_FORMAT",function(a,b,c,d){function e(a){return null!==a?a.toString():a}c.type("postTitleType",{encode:e,decode:e,is:function(){return!0}}),b.otherwise("/posts/lublin/"+moment().format(d)),a.state("postsView",{url:"/posts/lublin/{date}",title:function(a){return"Informator Kulturalny - Lublin "+a.date},controller:"PostsViewCtrl",resolve:{posts:["$stateParams","$q","PostsService",function(a,b,c){var e=a.date,f=moment(e,d,!0).isValid();return f?c.loadPostsForDate(e,d):b.reject({error:"bad date posts",text:e+" -- date is not valid"})}]},templateUrl:"views/posts.html"}).state("postsView.postView",{url:"/{post:postTitleType}",title:function(a){return"Informator Kulturalny - Lublin "+a.date+" "+a.post},resolve:{post:["$stateParams","$q","posts","PostsService",function(a,b,c,d){var e=a.post,f=a.date,g=d.getPostWithTitle(f,e);return g?g:b.reject({error:"bad title post",text:e+" was not found on date"+f})}],previousState:["$state",function(a){var b={name:a.current.name,params:a.params};return b}]},onEnter:["$state","ngDialog","post","previousState","$stateParams",function(a,b,c,d,e){var f=b.open({template:"views/post_full_template.html",controller:"PostModalCtrl",resolve:{post:function(){return c}}});f.closePromise.then(function(b){"notRedirect"!==b.value&&(""===d.name?a.go("postsView",{date:e.date},{notify:!1}):a.go(d.name,d.params,{notify:!1}))})}]}).state("postFormView",{url:"/post_form/{fbPostId}",title:function(a){return"Informator Kulturalny - Dodaj Post"},controller:"PostFormViewCtrl",templateUrl:"views/post_form2.html",resolve:{postToEdit:function(){return!1},fbPostID:["AuthService","$q","$stateParams",function(a,b,c){if(!c.fbPostId)return c.fbPostId;var d=a.returnUser();return d.profile?d.profile&&!d.profile.marketing?b.reject({error:"Not marketing member",text:"not a marketing member"}):c.fbPostId:b.reject({error:"Not logged",text:"you must be logged in"})}]}}).state("postFormEditPostView",{url:"/post_form/{date}/{postTitle:postTitleType}",title:function(a){return"Informator Kulturalny - Edytuj Post "+a.postTitle},controller:"PostFormViewCtrl",templateUrl:"views/post_form2.html",resolve:{posts:["$stateParams","$q","PostsService",function(a,b,c){var e=a.date,f=moment(e,d,!0).isValid();return f?c.loadPostsForDate(e,d):b.reject({error:"bad date edit",text:e+" -- date is not valid"})}],postToEdit:["posts","$stateParams","$q","PostsService",function(a,b,c,d){var e=b.postTitle,f=b.date,g=d.getPostWithTitle(f,e);return g?g:c.reject({error:"bad title edit",text:e+" was not found on date"+f})}],fbPostID:function(){return!1}}}).state("contactView",{url:"/contact",title:function(a){return"Informator Kulturalny - Kontakt"},templateUrl:"views/contact.html"}).state("marketingView",{url:"/marketing/{filterType}",title:function(a){return"Informator Kulturalny - Marketing"},templateUrl:"views/marketing.html",controller:"MarketingViewCtrl",resolve:{marketingMember:["AuthService","$q",function(a,b){var c=a.returnUser();return c.profile?c.profile&&!c.profile.marketing?b.reject({error:"Not marketing member",text:"not a marketing member"}):c:b.reject({error:"Not logged",text:"you must be logged in"})}],fbProfilesList:["MarketingService",function(a){return a.loadFbProfilesList()}],fbProfilesPosts:["MarketingService",function(a){return a.loadFbProfilesPosts()}]}}).state("unautorizedPostsView",{url:"/unautorized_posts",title:function(a){return"Informator Kulturalny - Nieautoryzowane posty"},templateUrl:"views/unauthorized_posts.html",controller:"UnauthorizedPostsViewCtrl",resolve:{staffMember:["AuthService","$q",function(a,b){var c=a.returnUser();return c.profile&&!c.profile.staff?b.reject({error:"Not staff member",text:"not a staff member"}):c}]}}).state("loginRegister",{url:"/login_register",title:function(a){return"Informator Kulturalny - Zaloguj się/Zarejestruj się"},templateUrl:"views/login_register.html",controller:"LoginRegisterViewCtrl",resolve:{user:["AuthService","$q",function(a,b){return a.isAnyoneLoggedIn()?b.reject({error:"Already logged in",text:"Already logged in"}):a.isAnyoneLoggedIn()}]}})}]).config(["AngularyticsProvider",function(a){a.setEventHandlers(["GoogleUniversal"])}]).run(["Angularytics",function(a){a.init()}]).run(["$rootScope","$window","ngDialog","$location","$state","MOMENT_URL_FORMAT",function(a,b,c,d,e,f){a.$on("$stateNotFound",function(a,b,c,d){console.log("$stateNotFound",b),e.go("postsView",{date:moment().format(f)})}),a.$on("$stateChangeError",function(a,b,c,d,g,h){console.log("$stateChangeError",h),e.go("postsView",{date:moment().format(f)})}),a.$on("$stateChangeStart",function(a,b,d,e,f,g){if("postsView.postView"==e.name){if("postsView"===b.name){var h="redirect";a.preventDefault()}else var h="notRedirect";c.closeAll(h)}}),a.$on("$stateChangeSuccess",function(a,c,d,e,f,g){b.document.title=c.title(d)}),a.$watch(function(){return d.path()},function(a){e.current["abstract"]||(b.document.title=e.current.title(e.params))})}]).constant("MOMENT_URL_FORMAT","DD.MM.YYYY").constant("MOMENT_FIREBASE_KEY_FORMAT","DD-MM-YYYY").constant("PICKER_INPUT_FORMAT","d mmmm yyyy").constant("MOMENT_PICKER_INPUT_DECODE_FORMAT","DD MMMM YYYY").constant("FIREBASE_URL","https://blazing-inferno-8063.firebaseio.com/").constant("CATEGORIES",["Theatre","Museum","Mussic","Gallery","Live","Clubs","Movie","Meeting","Workshops","ForKids","Sport","Poetry"]);app.config(["$translateProvider",function(a){a.translations("en",{TITLE:"Title",DATE:"Date",From:"From",Hours:"Time",ToDate:"Last to date",StartTimeIsRequired:"Start time is required",TimeFormattingWrong:"Time should be formatted like: 02:29 09:10 12:30 18:01 23:59",POSTWILLBEVALIDATED:"You are an unauthorized user. Your post will be validated by administration before being published.",LOGINTOPOST:"Please log in to add posts.",TITLEISREQUIRED:"Title is required.",DATEISREQUIRED:"Date is required.",DateFromIsAfterDateTo:"Date should be before date to",DateToIsBeforeDate:"Date to should be after date",DURATION:"Duration",StartTime:"Start time",EndTime:"End time",TEXT:"Text",TEXTISREQUIRED:"Text is required.",WEBSITE:"Website",PHOTO:"Photo",LOCATION:"Location",PRICE:"Price",PRICEISREQUIRED:"Price is required.",CATEGORIES:"Categories",ATLEASTONECATEGORY:"At least one category is required.",SUBMIT:"Submit",FORMERRORS:"Form contains errors.",SaveAsTemplate:"Save as template",NameOfTemplate:"Name of a template",SaveAsQuickInput:"Save as quick input",Theatre:"Theatre",Museum:"Museum",Gallery:"Gallery",ClassicMussic:"Classic Music",Live:"Live",Clubs:"Clubs",Movie:"Movie",Meeting:"Meeting",Workshops:"Workshops",ForKids:"For Kids",Mussic:"Music",Sport:"Sport",Poetry:"Poetry",Logowanie:"Log in","Zaloguj się":"Log in",Rejestracja:"Register","Zarejestruj się":"Register","Wyloguj się":"Log out","Dodaj wydarzenie":"Add post",About:"About",Associates:"Associates",Kontakt:"Contact us",unPosts:"Unauthorized Posts",SubmittedBy:"Submitted by",FREE:"Free",PhotoTooltip:'Podaj link do zdjęcia, np. wyszukaj zdjęcie na google grafika, wybierz wyszukane zdjęcie, kliknij "Pokaż obraz" i skopiuj link.',WebsiteTooltip:"Jeżeli twoje wydarzenie ma swoją stronę, tutaj możesz podać jej adres.",LocationTooltip:"Podaj adres miejsca w którym odbywa się twoje wydarzenie - zamieni się on automatycznie w link do google maps.",CategoriesTooltip:"Wybiesz kategorię która najlepiej określa twoje wydarzenie, zalecamy maksymalnie trzy kategorie przy jednym wydarzeniu.",HoursTooltip:"How much time event takes.",ToDateTooltip:"If event takes longer than one day - provide date of last occurring, for example: art exhibition will be open for next month every day.",TemplateTooltip:"Save as template.",Email:"Email","Hasło":"Password","Potwierdź hasło":"Confirm password","Nazwa użytkownika":"Username",ResetPassword:"Reset password",PreviewLink:"Preview of post after clicking the link",PreviewMain:"Preview of post on main site",UserPosts:"User posts",UserPostsUn:"User unauthorized posts",FindEvents:"Find Events",BackToThisDay:"Back to posts",PreviousPost:"Previous post",NextPost:"Next post","Następny dzień":"Next Day",Save:"Save",Zamknij:"Close",Edit:"Edit",Delete:"Delete",Kalendarz:"Calendar","Wydarzenia Lublin":"Posts Lublin",Kategorie:"Categories"}).translations("pl",{TITLE:"Tytuł",DATE:"Data",From:"Od",Hours:"Czas",ToDate:"Trwa do dnia",StartTimeIsRequired:"Dodaj godzinę",TimeFormattingWrong:"Poprawny format: 02:29 09:10 12:30 18:01 23:59",POSTWILLBEVALIDATED:"Jesteś nieautoryzowanym użytkownikiem, twój post zostanie sprawdzony przez administrację zanim zostanie opublikowany",LOGINTOPOST:"Zaloguj się aby dodawać posty",TITLEISREQUIRED:"Dodaj tytuł",DATEISREQUIRED:"Dodaj datę",DateFromIsAfterDateTo:"Data powinna być wcześniejsza niż data do",DateToIsBeforeDate:"Data do powinna być późniejsza niż data",DURATION:"Czas trwania",StartTime:"Godzina rozpoczęcia",EndTime:"Godzina zakończenia",TEXT:"Tekst",TEXTISREQUIRED:"Dodaj tekst",WEBSITE:"Strona internetowa",PHOTO:"Zdjęcie",LOCATION:"Miejsce",Price:"Cena",PRICEISREQUIRED:"Dodaj cenę",CATEGORIES:"Kategorie",ATLEASTONECATEGORY:"Dodaj przynajmniej jedną kategorię",SUBMIT:"Dodaj",FORMERRORS:"Formularz zawiera błędy",SaveAsTemplate:"Zapisz jako szablon",NameOfTemplate:"Nazwa szablonu",SaveAsQuickInput:"Zapisz jako szybki wybór",Theatre:"Teatr",Museum:"Muzeum",Gallery:"Galeria",ClassicMussic:"Muzyka Klasyczna",Live:"Na Żywo",Clubs:"Clubbing",Movie:"Film",Meeting:"Spotkanie",Workshops:"Warsztaty",ForKids:"Dla Dzieci",Mussic:"Muzyka",Sport:"Sport",Poetry:"Poezja",Logowanie:"Logowanie","Wyloguj się":"Wyloguj się",Rejestracja:"Rejestracja","Dodaj wydarzenie":"Dodaj wydarzenie","O nas":"O nas",Partnerzy:"Partnerzy",Kontakt:"Kontakt",unPosts:"Nieautoryzowane Posty","Nadesłane przez":"Nadesłane przez","Za darmo":"Za darmo",PhotoTooltip:'Podaj link do zdjęcia, np. wyszukaj zdjęcie na google grafika, wybierz wyszukane zdjęcie, kliknij "Pokaż obraz" i skopiuj link.',WebsiteTooltip:"Jeżeli twoje wydarzenie ma swoją stronę, tutaj możesz podać jej adres.",LocationTooltip:"Podaj adres miejsca w którym odbywa się twoje wydarzenie - zamieni się on automatycznie w link do google maps.",CategoriesTooltip:"Wybiesz kategorię która najlepiej określa twoje wydarzenie, zalecamy maksymalnie trzy kategorie przy jednym wydarzeniu.",HoursTooltip:"Podaj jak długo będzie trwać wydarzenie.",ToDateTooltip:"Jeżeli wydarzenie trwa dłużej niż jeden dzień - podaj ostatnią datę kiedy wydarzenie się odbędzie, na przykład: wystawa będzie otwarta przez najbliższy miesiąc.",TemplateTooltip:"Zapisz jako szablon.",Email:"Email","Hasło":"Hasło","Potwierdź hasło":"Potwierdź hasło","Nazwa użytkownika":"Nazwa użytkownika","Zresetuj hasło":"Zresetuj hasło",PreviewLink:"Widok postu po kliknięciu w link",PreviewMain:"Widok postu na stronie głównej",UserPosts:"Posty użytkownika",UserPostsUn:"Nieautoryzowane posty użytkownika",FindEvents:"Znajdź wydarzenia",BackToThisDay:"Wróc do",PreviousPost:"Poprzedni post","Następny post":"Następny post","Następny dzień":"Następny dzień",Save:"Zapisz",Zamknij:"Zamknij",Edit:"Edytuj",Delete:"Usuń",Kalendarz:"Kalendarz","Wydarzenia Lublin":"Wydarzenia Lublin",Kategorie:"Kategorie"}).fallbackLanguage("en_US").registerAvailableLanguageKeys(["en","pl"],{en_US:"en",en_UK:"en",en_GB:"en",pl_PL:"pl",pl_pl:"pl"}),a.determinePreferredLanguage()}]),app.directive("googlePlaces",function(){return{require:"ngModel",link:function(a,b,c,d){var e={types:[],componentRestrictions:{}};a.gPlace=new google.maps.places.Autocomplete(b[0],e),google.maps.event.addListener(a.gPlace,"place_changed",function(){a.$apply(function(){d.$setViewValue(b.val())})})}}}),app.directive("categoriesValidator",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){var b=a>0;return d.$setValidity("atLeastOneCategory",b),a}d.$formatters.push(e)}}}),app.directive("dateFromValidator",["MOMENT_URL_FORMAT","MOMENT_PICKER_INPUT_DECODE_FORMAT",function(a,b){return{require:"ngModel",link:function(c,d,e,f){function g(a){return""===a?f.$setValidity("dateRequired",!1):f.$setValidity("dateRequired",!0),a}function h(d){var e=moment(c.post.dateTo,a),g=moment(d,b);return d&&c.post.dateTo?g.isBefore(e,"days")?f.$setValidity("dateIsAfterDateTo",!0):f.$setValidity("dateIsAfterDateTo",!1):f.$setValidity("dateIsAfterDateTo",!0),d}f.$setValidity("dateRequired",!1),f.$parsers.push(g),f.$parsers.push(h),f.$formatters.push(g)}}}]),app.directive("dateToValidator",["MOMENT_URL_FORMAT","MOMENT_PICKER_INPUT_DECODE_FORMAT",function(a,b){return{require:"ngModel",link:function(c,d,e,f){function g(d){var e=moment(c.post.date,a),g=moment(d,b);return d&&c.post.date&&g.isBefore(e,"days")?f.$setValidity("dateToIsBeforeDate",!1):f.$setValidity("dateToIsBeforeDate",!0),d}f.$parsers.push(g)}}}]),app.directive("setClassWhenAtTop",["$window",function(a){var b=angular.element(a);return{restrict:"A",link:function(a,c,d){var e,f=d.setClassWhenAtTop,g=parseInt(d.paddingWhenAtTop,10),h=parseInt(d.topCssValue,0),i="true"===d.giveParentHeight,j=c.parent();$("#cont").on("scroll",function(){e=j.offset().top-g,b.scrollTop()>=e?(c.addClass(f),i&&j.height(c.height()),c.css("top",h)):(c.removeClass(f),j.css("height",null),i||c.css("top","auto"))})}}}]),app.directive("timeValidator",function(){return{require:"ngModel",link:function(a,b,c,d){function e(a){if(""===a)d.$setValidity("timeFormatting",!0);else{var b=moment(a,"HH:mm",!0).isValid();d.$setValidity("timeFormatting",b)}return a}d.$parsers.push(e)}}}),app.directive("img-safe",function(){return{restrict:"E",link:function(a,b,c){b.error(function(){b.css("display","none")})}}}),app.factory("eventService",["Angularytics","MOMENT_URL_FORMAT",function(a,b){var c={};return c.trackDaysDifference=function(c,d){a.trackEvent("Days difference",c,"days difference "+moment(d,b).diff(moment().startOf("day"),"days"))},c.trackPostsLoad=function(b,c,d){console.log(d);var e=JSON.stringify(d);console.log(e);var f;if("loadMore"==b);else if("initial"==b);else if("paginatorDateChangedDateAlreadyShown"==b){f=f+" date picked "+moment(date).format("DD-M-YYYY")}else if("paginatorDateChangedDateNotShown"==b){f=f+" days from picked "+dayDiff}a.trackEvent("Posts Loaded",e,f)},c.trackPagesNavigation=function(b,c){a.trackEvent("Pages Navigation",b,c)},c.trackOutsidePagesNavigation=function(b,c){a.trackEvent("Outside Pages Navigation",b,c)},c.trackLinksFromPost=function(b,c){a.trackEvent("Links From Posts",b,c)},c.trackPostNavigation=function(b,c){a.trackEvent("Post Navigation",b,c)},c.trackPostDaysDifference=function(b,c){a.trackEvent("Post Days Difference",b,"days difference "+moment(c).diff(moment(),"days"))},c.trackDatesNavigation=function(b,c,d){var e,f=JSON.stringify(d);if("loadMore"==b);else if("initial"==b);else if("paginatorDateChangedDateAlreadyShown"==b){e=e+" date picked "+moment(date).format("DD-M-YYYY")}else if("paginatorDateChangedDateNotShown"==b){e=e+" days from picked "+dayDiff}a.trackEvent("Dates Navigation",f,e)},c.trackCategoriesFilteringBox=function(b,c){"unChecked"==b?a.trackEvent("Categories Filtering Box","Category unChecked",c):"Checked"==b&&a.trackEvent("Categories Filtering Box","Category Checked",c)},c.trackCategoriesChosen=function(b,c){"unChecked"==b?a.trackEvent("Categories Filtering Box","Category unChecked",c):"Checked"==b&&a.trackEvent("Categories Filtering Box","Category Checked",c)},c}]),app.factory("AppStateService",["$rootScope","$mdMedia",function(a,b){function c(){function a(){h=d(),console.log(h)}window.matchMedia("screen and (min-width: 601px) and (max-width: 992px)").addListener(function(){a()}),window.matchMedia("screen and (min-width: 0px) and (max-width: 600px)").addListener(function(){a()}),window.matchMedia("screen and (min-width: 993px)").addListener(function(){a()})}function d(){return window.matchMedia("(min-width: 993px)").matches?4:window.matchMedia("(min-width: 601px)").matches?2:1}function e(a,b){b&&(h=a)}var f,g={},h=d();return c(),function(){a.$watch(function(){return b("sm")},function(a,b){e(1,b)}),a.$watch(function(){return b("md")},function(a,b){e(2,b)}),a.$watch(function(){return b("lg")},function(a,b){e(3,b)}),a.$watch(function(){return b("gt-lg")},function(a,b){e(4,b)})}(),g.getPickedCategories=function(){return f},g.getNumberOfColumns=function(){return h},g}]),app.factory("PostsService",["$firebaseArray","$firebaseObject","FIREBASE_URL","MOMENT_FIREBASE_KEY_FORMAT","MOMENT_URL_FORMAT",function(a,b,c,d,e){function f(a,b){return moment(a,b).format(d)}function g(a,c,d,g){var h=c?a.title:null,j=b(i.child("posts_on_date").child(f(d,e)));j.$loaded().then(function(){j[g]=c,j.$save()}),i.child("posts_by_user").child(a.creatorUID).child(f(d,e)).child(g).set(h)}function h(a,c,d){var e=b(i.child("unauthorized_posts_by_user").child(a.creatorUID));e.$loaded().then(function(){e[d]=c,e.$save()})}var i=new Firebase(c),j={},k={},l={};return j.getPostsObject=function(){return k},j.getUnauthorizedPostsObject=function(){return l},j.loadUnauthorizedPostsForUser=function(b){return l[b]=a(i.child("unauthorized_posts_by_user").child(b)),l[b].$loaded()},j.loadAllUnauthorizedPosts=function(){function b(b){for(var c=0;c<b.length;c++){var d=b[c].$id;l[d]=a(i.child("unauthorized_posts_by_user").child(d))}}a(i.child("unauthorized_posts_by_user")).$loaded().then(function(a){b(a)})},j.rejectPost=function(a,b,c){window.confirm("Czy na pewno chcesz odrzucić post?")&&(a.rejectedBy={},a.rejectedBy.email=c.profile.username,a.rejectedBy.uid=c.uid,j.addRejectedPost(a,b),j.deleteUnauthorizedPost(a,b))},j.authorizePost=function(a,b,c){if(window.confirm("Czy na pewno chcesz autoryzować post?")){a.authorizedBy={},a.authorizedBy.email=c.profile.username,a.authorizedBy.uid=c.uid;var d=j.buildRangeArray(a.date,a.dateTo);for(var e in d)j.addAuthorizedPost(a,d[e],b);j.deleteUnauthorizedPost(a,b)}},j.deleteAuthorizedPostsUserClick=function(a,b){if(window.confirm("Czy na pewno chcesz usunąć post?")){var c=j.buildRangeArray(a.date,a.dateTo),d=a.dateOfCreation;for(var e in c)j.deleteAuthorizedPost(a,c[e],d)}},j.loadPostsForDate=function(b,c){return k[b]?k[b]:(k[b]=a(i.child("posts_on_date").child(f(b,c)).orderByChild("startTime")),k[b].$loaded())},j.getPostWithTitle=function(a,b){for(var c=0;c<k[a].length;c++)if(k[a][c].title==b)return k[a][c];return!1},j.addAuthorizedPost=function(a,b,c){g(a,a,b,c)},j.deleteAuthorizedPost=function(a,b,c){g(a,null,b,c)},j.buildRangeArray=function(a,b){var c=moment(a,e),d=b?moment(b,e):c,f=[],g=d.diff(c,"days");f.push(a);for(var h=0;g-1>=h;h++)f.push(c.add(1,"days").format(e));return f},j.addUnauthorizedPost=function(a,b){h(a,a,b)},j.updateUnauthorizedPost=function(a,b){h(a,a,b)},j.deleteUnauthorizedPost=function(a,b){h(a,null,b)},j.addRejectedPost=function(a,c){var d=b(i.child("rejected_posts_by_user").child(a.creatorUID));d.$loaded().then(function(){d[c]=a,d.$save()})},j.checkIfFbEventAdded=function(a,b,c){var d=a.id,e=d.split("_")[1];b(e,"start_time").then(function(a){return console.log(a),console.log(f(a.data.start_time,null)),i.child("posts_on_date").child(f(a.data.start_time,null)).orderByChild("url").equalTo("https://www.facebook.com/events/"+a.data.id).once("value",c)},function(a){console.log(a),alert(a.data.error.message)})},j.getAllPosts=function(){return b(i.child("posts_on_date")).$loaded()},j}]),app.factory("AuthService",["$firebaseAuth","FIREBASE_URL","$firebaseObject","$window",function(a,b,c,d){function e(a,b,c){var d={dateOfCreation:moment().format("DD.MM.YYYY HH:mm"),username:b},e=f.child("profile").child(a);return e.set(d,c)}var f=new Firebase(b),g={},h=a(f),i={};return h.$onAuth(function(a){a?(angular.copy(a,i),i.profile=c(f.child("profile").child(a.uid)),f.child("profile").child(a.uid).child("lastLogin").set(moment().format("DD.MM.YYYY HH:mm"))):(i.profile&&i.profile.$destroy(),angular.copy({},i))}),g.authWithPassword=function(a,b){return h.$authWithPassword({email:a,password:b})},g.createUser=function(a,b,c){h.$createUser({email:a,password:b}).then(function(f){g.authWithPassword(a,b).then(function(){e(f.uid,c,function(){d.location.href="#/"})})})["catch"](function(a){console.log(a)})},g.returnUser=function(){return i},g.requireAuth=function(){return h.$requireAuth()},g.logout=function(){h.$unauth()},g.isAnyoneLoggedIn=function(){return h.$getAuth()},g}]),app.factory("ProfileService",["FIREBASE_URL",function(a){var b=new Firebase(a),c={};return c.saveQuickInput=function(a,c,d,e){b.child("profile").child(e).child("quickInput").child(a).child(c).set(d)},c}]),app.factory("MarketingService",["$firebaseArray","$firebaseObject","FIREBASE_URL",function(a,b,c){var d=new Firebase(c),e={},f=[],g=[],h=b(d.child("timers"));return e.updateLastTime=function(a){d.child("timers").child("fbPostsRefresh").set(a)},e.getTimers=function(){return h},e.loadFbProfilesList=function(){return f=a(d.child("facebook_profiles")),f.$loaded()},e.loadFbProfilesPosts=function(){return g=a(d.child("facebook_profiles_posts").limitToLast(350)),g.$loaded()},e.getFbProfilesList=function(){return f},e.getFbProfilesPosts=function(){return g},e.addFbProfile=function(a){f.$add(a)},e.updateFbProfile=function(a){f.$save(a)},e.removeFbProfile=function(a){f.$remove(a)},e.addFbProfilePost=function(a){return g.$add(a)},e.updateFbProfilePost=function(a){g.$save(a)},e}]),app.controller("HeaderComponentCtrl",["$scope","AuthService","eventService","$window","$mdUtil","$mdSidenav","$state","MOMENT_URL_FORMAT",function(a,b,c,d,e,f,g,h){function i(a){var b=e.debounce(function(){f(a).toggle().then(function(){})},300);return b}function j(a){f(a).close().then(function(){})}a.signedIn=b.isAnyoneLoggedIn,a.logout=b.logout,a.user=b.returnUser(),a.todayDateFormatted=moment().format(h),a.trackPagesNavigation=function(b,e,f,g){b.preventDefault(),c.trackPagesNavigation(e,f),g?d.location.href="#!"+e+"/"+a.user.uid:d.location.href="#!"+e},a.trackOutsideNavigation=function(a,b,e){a.preventDefault(),c.trackOutsidePagesNavigation(b,e),d.location.href=b},a.openUnPosts=function(){g.go("unautorizedPostsView")},a.openMarketing=function(){g.go("marketingView")},a.toggleLeft=i("left"),a.closeSideNav=j}]),app.controller("PostsViewCtrl",["$scope","CATEGORIES","AuthService","AppStateService","PostsService","eventService","$location","$rootScope","$stateParams","$state","MOMENT_URL_FORMAT","PICKER_INPUT_FORMAT","$mdUtil","$mdSidenav",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(b,c){var d=a.loadedDays.indexOf(b);d>-1?(q(d),c+=" already loaded"):(p(b,0),a.loadedDays=[b],c+=" not loaded"),f.trackDaysDifference(c,b)}function p(b,c){j.go("postsView",{date:b},{notify:!1}),a.activeIndex=c}function q(b){var c=0===b?a.dateToolbarHeight:-10;$("html, body").animate({scrollTop:$("#"+b).offset().top-c},500).promise().done(function(){p(a.loadedDays[b],b)})}a.loadedDays=[i.date],a.posts=e.getPostsObject(),a.activeIndex=0,a.nextDayDate=function(){return moment(a.loadedDays[a.activeIndex],k).add(1,"days").format(k)},a.previousDayDate=function(){return moment(a.loadedDays[a.activeIndex],k).add(-1,"days").format(k)},a.appendDayDate=function(){return moment(a.loadedDays[a.loadedDays.length-1],k).add(1,"days").format(k)},a.user=c.returnUser(),a.categories=b,a.categoriesFormattedModel=b.map(function(a){return{name:a,picked:!1}}),a.showCategories=!1,a.categoriesForSearch=d.getPickedCategories,a.desiredNumberOfColumns=d.getNumberOfColumns(),a.dateToolbarHeight=48,$("#pushPinToolbar").pushpin({top:a.dateToolbarHeight});$("#dateStickyToolbar").pickadate({monthsFull:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],monthsShort:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"],weekdaysFull:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],weekdaysShort:["niedz.","pn.","wt.","śr.","cz.","pt.","sob."],today:"Dzisiaj",clear:"Usuń",close:"Zamknij",firstDay:1,format:l,formatSubmit:"yyyy/mm/dd",labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",onSet:function(){var a=$("#dateStickyToolbar").pickadate(),b=a.pickadate("picker").get("select"),c=moment(b.obj).format(k);o(c,"toolbar datepicker")},onOpen:function(){var b=$("#dateStickyToolbar").pickadate(),c=b.pickadate("picker");c.set("select",a.loadedDays[a.activeIndex],{format:k.toLowerCase()})},onClose:function(){$("html").css("padding","0px"),$(document.activeElement).blur()}});h.$on("duScrollspy:becameActive",function(b,c){var d=c.attr("IK-active");p(a.loadedDays[d],d)}),a.moveDay=function(b,c){b.preventDefault();var d=a.loadedDays[a.activeIndex],e=moment(d,k).add(c,"days").format(k);o(e,"toolbar arrows")},a.appendDay=function(b){b.preventDefault();var c=a.loadedDays[a.loadedDays.length-1],d=moment(c,k).add(1,"days").format(k);e.loadPostsForDate(d,k),a.loadedDays.push(d),f.trackDaysDifference("appending button one day more",d)},a.openPostModal=function(a,b,c){a.preventDefault(),j.go("postsView.postView",{post:b.title,date:c},{notify:!1})},a.deletePost=function(a,b){e.deleteAuthorizedPostsUserClick(a,b)},a.getLinkUrl=function(b){return"rightArrow"===b?j.href("postsView",{date:a.nextDayDate()}):"leftArrow"===b?j.href("postsView",{date:a.previousDayDate()}):"nextDay"===b?j.href("postsView",{date:a.appendDayDate()}):void 0}}]),app.controller("PostModalCtrl",["$scope","$window","post","eventService",function(a,b,c,d){a.post=c,a.trackLinksFromPost=function(a,c,e){a.preventDefault(),d.trackLinksFromPost(c,e),b.open(e)}}]),app.controller("UnauthorizedPostModalCtrl",["$scope","postResolve",function(a,b){a.post=b}]),app.controller("PostFormViewCtrl",["$scope","$http","ProfileService","AuthService","PostsService","postToEdit","CATEGORIES","MOMENT_URL_FORMAT","PICKER_INPUT_FORMAT","MOMENT_PICKER_INPUT_DECODE_FORMAT","$window","$timeout","fbPostID","$state",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){function o(c){var d="https://graph.facebook.com/v2.4/"+c+"?access_token="+a.user.profile.ik_token+"&fields=name,description,place,start_time,cover";console.log(d),b({method:"GET",url:d}).success(function(a,b){b=b,a=a,console.log(a),p(a)}).error(function(a,b){a=a||"Request failed",b=b,console.log(a)})}function p(b){a.post.title=b.name,a.post.text=b.description,a.post.date=moment(b.start_time).format(h),a.date_DatePicker=moment(b.start_time).format(j),a.post.startTime=moment(b.start_time).format("HH:mm"),b.end_time&&(a.post.dateTo=moment(b.end_time).format(h),a.dateTo_DatePicker=moment(b.end_time).format(j),a.post.endTime=moment(b.end_time).format("HH:mm")),b.place&&b.place.location&&b.place.location.street?a.post.location=b.place.location.street:b.place&&b.place.name&&(a.post.location=b.place.name),a.post.url="https://www.facebook.com/events/"+b.id,a.post.photo1=b.cover.source}function q(){a.post.creator=a.user.profile?a.user.profile.username:"anonymous",a.post.creatorUID=a.user.profile?a.user.uid:"anonymous",a.post.dateOfCreation=moment().format("x"),a.user.profile&&a.user.profile.authorized?r(a.post.dateOfCreation):e.addUnauthorizedPost(a.post,a.post.dateOfCreation),m?n.go("marketingView",{filterType:"created_event"}):k.location.href="#!/"}function r(b){var b=b,c=e.buildRangeArray(a.post.date,a.post.dateTo);for(var d in c)e.addAuthorizedPost(a.post,c[d],b)}function s(){a.user&&(a.post.dateOfLastEdit=Firebase.ServerValue.TIMESTAMP,a.user.profile.authorized?t():e.updateUnauthorizedPost(a.post,a.post.dateOfCreation),k.location.href="#/")}function t(){var b=a.post.dateOfCreation,c=e.buildRangeArray(v,w),d=e.buildRangeArray(a.post.date,a.post.dateTo);for(var f in c)e.deleteAuthorizedPost(a.post,c[f],b);for(var f in d)e.addAuthorizedPost(a.post,d[f],b)}var u=f?!0:!1;if(a.post=u?f:{},a.atLeastOneCategory=u?Object.keys(a.post.categories).length:0,u)var v=a.post.date,w=a.post.dateTo;else a.post.price="0.00",a.post.categories={};a.user=d.returnUser(),a.categories=g,function(){$(".date_input_container").pickadate({monthsFull:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],monthsShort:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"],weekdaysFull:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],weekdaysShort:["niedz.","pn.","wt.","śr.","cz.","pt.","sob."],today:"Dzisiaj",clear:"Usuń",close:"Zamknij",firstDay:1,format:i,formatSubmit:"yyyy/mm/dd",labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",onSet:function(){var b=$(".date_input_container").pickadate(),c=b.pickadate("picker");null===c.get("select")?a.post.date="":a.post.date=moment(c.get("select").obj).format(h),a.$apply(a.post.date)},onClose:function(){var a=$(".date_input_container").pickadate(),b=a.pickadate("picker");null===b.get("select")&&angular.element("#date_input_container").removeClass("md-input-focused")},onStart:function(){if(u){var b=$(".date_input_container").pickadate(),c=b.pickadate("picker");l(function(){c.set("select",a.post.date,{format:h.toLowerCase()})},0)}}}),$(".dateTo_input_container").pickadate({monthsFull:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],monthsShort:["sty","lut","mar","kwi","maj","cze","lip","sie","wrz","paź","lis","gru"],weekdaysFull:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"],weekdaysShort:["niedz.","pn.","wt.","śr.","cz.","pt.","sob."],today:"Dzisiaj",clear:"Usuń",close:"Zamknij",firstDay:1,format:i,formatSubmit:"yyyy/mm/dd",labelMonthNext:"Next month",labelMonthPrev:"Previous month",labelMonthSelect:"Select a month",labelYearSelect:"Select a year",onSet:function(){var b=$(".dateTo_input_container").pickadate(),c=b.pickadate("picker");null===c.get("select")?a.post.dateTo="":a.post.dateTo=moment(c.get("select").obj).format(h),a.$apply(a.post.dateTo)},onClose:function(){var a=$(".dateTo_input_container").pickadate(),b=a.pickadate("picker");null===b.get("select")&&angular.element("#dateTo_input_container").removeClass("md-input-focused")},onStart:function(){if(u&&a.post.dateTo){var b=$(".dateTo_input_container").pickadate(),c=b.pickadate("picker");l(function(){c.set("select",a.post.dateTo,{format:h.toLowerCase()})},0)}}})}(),m&&o(m),a.toggleCategoryClick=function(b){var c=a.post.categories[b];c?(a.atLeastOneCategory--,delete a.post.categories[b]):(a.atLeastOneCategory++,a.post.categories[b]=!0)},a.isCategoryApplied=function(b){return a.post.categories[b]},a.saveAsQuickInput=function(b){if(a.post[b]){var d=window.prompt("Podaj nazwę.");if(d)return a.user.profile?void(a.user.profile.quickInput&&a.user.profile.quickInput[b]&&a.user.profile.quickInput[b][d]?window.confirm("Szybki wybór o takiej nazwie już istnieje, czy chcesz go zamienić?")&&l(function(){c.saveQuickInput(b,d,a.post[b],a.user.uid)},0):l(function(){c.saveQuickInput(b,d,a.post[b],a.user.uid)},0)):void window.alert("Niezalogowani użytkownicy nie mogą używać szybkiego wybierania.")}},a.useQuickInput=function(b,c){a.post[b]=a.user.profile.quickInput[b][c]},a.getId=function(){var a=window.prompt("id of event");a&&o(a)},a.submitOrEditPost=function(){a.postForm.$invalid||0==a.atLeastOneCategory||(u?s():q())}}]),app.controller("UnauthorizedPostsViewCtrl",["$scope","PostsService","AppStateService","ngDialog","staffMember",function(a,b,c,d,e){b.loadAllUnauthorizedPosts(),a.allUnPosts=b.getUnauthorizedPostsObject(),a.desiredNumberOfColumns=c.getNumberOfColumns(),a.getNameFromUID=function(b){return a.allUnPosts[b][0]?a.allUnPosts[b][0].creator:void 0},a.rejectPost=function(a){b.rejectPost(a,a.dateOfCreation,e)},a.authorizePost=function(a){b.authorizePost(a,a.dateOfCreation,e)},a.openPostModal=function(a,b){a.preventDefault();d.open({template:"views/post_full_template.html",controller:"UnauthorizedPostModalCtrl",
resolve:{postResolve:function(){return b}}})}}]),app.controller("LoginRegisterViewCtrl",["$scope","AuthService","$window",function(a,b,c){a.authWithPassword=function(){b.authWithPassword(a.emailLogin,a.passwordLogin).then(function(){c.location.href="#/"})},a.createUser=function(){a.passwordRegister1===a.passwordRegister2&&b.createUser(a.emailRegister,a.passwordRegister1,a.usernameRegister)}}]),app.controller("FooterComponentCtrl",["$scope","eventService","$window",function(a,b,c){a.trackPagesNavigation=function(d,e,f){b.trackPagesNavigation(d,e),f?c.location.href="#"+d+"/"+a.user.uid:c.location.href="#"+d},a.trackOutsideNavigation=function(a,d,e){a.preventDefault(),b.trackOutsidePagesNavigation(d,e),c.open(d)}}]),app.controller("MarketingViewCtrl",["$scope","$window","$http","$state","marketingMember","fbProfilesList","fbProfilesPosts","MarketingService","PostsService","MOMENT_FIREBASE_KEY_FORMAT","MOMENT_URL_FORMAT","$stateParams",function(a,b,c,d,e,f,g,h,i,j,k,l){function m(a,b,d,e,f,g){var h="https://graph.facebook.com/v2.4/"+a+"?access_token="+u;return b&&(h+="&fields="+b),d&&(h+="&since="+d),e&&(h+="&summary="+e),f&&(h+="&filter="+f),g&&(h+="&limit="+g),c.get(h)}function n(a){var b=window.confirm("Czy dodać posty zamieszczone przez ten profil z dzisiaj oraz wczoraj?");if(b){var c=moment().add(-1,"days").startOf("day").format("X");o(a,c,!0)}}function o(a,b,c){m(a+"/posts","id,from,status_type,message,updated_time,created_time,shares",b).then(function(a){return c&&(q(a.data.data),p(a.data)),a.data},function(a){return void 0})}function p(a){a.paging&&c.get(a.paging.next).then(function(a){a.data.data[0]&&(q(a.data.data),p(a.data))},function(a){return void 0})}function q(b){for(var c in b)h.addFbProfilePost(b[c]).then(function(b){a.fbProfilesPosts.$getRecord(b.key()).$newFbPost=!0})}function r(a){i.checkIfFbEventAdded(a,m,function(b){return b.exists()&&(b.forEach(function(b){var c=b.val().title,d=b.val().date;a.eventAdded=d+"/"+c}),h.updateFbProfilePost(a)),!0})}function s(a,b,c){var d=null;"comments"===b&&(d="stream"),m(a.id+"/"+b,null,null,!0,d,1e4).then(function(d){a[b]=d.data.summary.total_count,c&&("likes"===b&&(a.has_liked=d.data.summary.has_liked),"comments"===b&&(a.has_commented=t(d))),h.updateFbProfilePost(a)},function(a){return void 0})}function t(a){for(var b=0;b<a.data.data.length;b++)if(0xfbecdbd74310==a.data.data[b].from.id)return!0;return!1}a.fbProfilesList=f,a.fbProfilesPosts=g,console.log(a.fbProfilesPosts),a.timers=h.getTimers(),a.lastTimePostsRefresh=null,a.filterTime=null,a.filterType=l.filterType,a.orderTypes=["najnowsze","profil","typ"],a.orderType="najnowsze",a.userProfile=e.profile,a.showProfilesTable=!1;var u=e.profile.ik_token;$("#type_dropdown_activator").dropdown({inDuration:300,outDuration:225,constrain_width:!1,hover:!1,gutter:0,belowOrigin:!1}),a.addFbProfile=function(){var c=b.prompt("nazwa profilu na facebook");if(c){for(var d=0;d<a.fbProfilesList.length;d++)if(a.fbProfilesList[d].name===c)return void b.alert("podany profil jest już dodany do listy");m(c).then(function(a){var b={};b.name=c,h.addFbProfile(b),n(c)},function(a){alert(a.data.error.message)})}},a.getNewProfilePosts=function(){var b=moment().format("X");a.lastTimePostsRefresh=a.timers.fbPostsRefresh,h.updateLastTime(b);for(var c=0;c<a.fbProfilesList.length;c++){var d=a.fbProfilesList[c].name;o(d,a.lastTimePostsRefresh,!0)}},a.removeFbProfile=function(a){window.confirm("Czy na pewno chcesz usunąć ten profil z listy?")&&h.removeFbProfile(a)},a.toggleEventSource=function(a){if(a.eventSource){if(!b.confirm("Czy na pewno chcesz odznaczyć ten profil?"))return;a.eventSource=!1,h.updateFbProfile(a)}else{if(!b.confirm("Czy na pewno chcesz oznaczyć ten profil jako źródło wydarzeń?"))return;a.eventSource=!0,h.updateFbProfile(a)}},a.filterByTime=function(){var b=window.prompt("Podaj datę. 01-12-2015 10-01-2015");b&&(moment(b,"DD-MM-YYYY",!0).isValid()?a.filterTime=moment(b,"DD-MM-YYYY HH:mm"):alert("Niewłaściwa data"))},a.filterByType=function(b){return"Wszystkie"===b?void(a.filterType=b):void(a.filterType=b)},a.changeOrderType=function(b){var c=a.orderTypes.indexOf(b)+1;c===a.orderTypes.length&&(c=0),a.orderType=a.orderTypes[c]},a.orderFunction=function(b){return"najnowsze"===a.orderType?-moment(b.created_time).format("X"):"profil"===a.orderType?b.from.name:"typ"===a.orderType?b.status_type:void 0},a.addEvent=function(a){var b=a.id,c=b.split("_")[1];d.go("postFormView",{fbPostId:c})},a.checkIfNewPost=function(a){return a.$newFbPost?"background-color: #F2F2F2;":""},a.checkProfilePosts=function(){for(var b=0;b<a.fbProfilesPosts.length;b++)a.fbProfilesPosts[b].eventAdded||"created_event"!==a.fbProfilesPosts[b].status_type||r(a.fbProfilesPosts[b]),s(a.fbProfilesPosts[b],"likes",!0),s(a.fbProfilesPosts[b],"comments",!0)},a.buildSitemap=function(){function a(a,b,c){var d="";return d+="<url>\n",d+="	<loc>"+a+"</loc>\n",d+="	<priority>"+b+"</priority>\n",d+="	<changefreq>"+c+"</changefreq>\n",d+="</url>\n"}function b(a){var b=a;return b=b.replace(/&/g,"&amp;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;")}var c="http://www.informatorkulturalny.com",d="/#!",e="/posts/lublin/",f=c+d+e,g=["/post_form/","/contact","/login_register"],h="",l="",m="",n="";i.getAllPosts().then(function(e){e.forEach(function(c,d){var e=moment(d,j),g=e.isBefore(moment(),"days"),i=e.format(k),m=g?"never":"daily",n=g?"0.7":"0.8",o=f+i;h+=a(o,n,m);for(var p in c){var q=b(c[p].title),o=f+i+"/"+q,n=g?"0.5":"0.6",m="never";l+=a(o,n,m)}}),g.forEach(function(b,e){var f=c+d+b,g="0.4",h="monthly";m+=a(f,g,h)}),n=a(c,"1.0","daily");var i='<?xml version="1.0" encoding="UTF-8"?>\n',o='<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n',p="</urlset>",q=i+o+n+h+l+m+p;window.open("data:text/plain;charset=utf-8,"+encodeURIComponent(q))})},a.showProfilesTableToggle=function(){a.showProfilesTable=!a.showProfilesTable}}]),app.filter("priceFilter",function(){return function(a){return"0.00"==a||"0.0"==a||"0"==a?"FREE":a}}),app.filter("truncate",function(){return function(a,b,c,d){if(a){var e=/[!-\/:-@\[-`{-~]$/;if(a.length>b){var f=$.trim(a).substring(0,b).split(" ").slice(0,-1).join(" ");return c&&(f=f.replace(e,"")),f+d}return a}}}),app.filter("postsModuloFilter",function(){return function(a,b,c){for(var d=[],e=0;e<a.length;e++)a[e]&&a[e].title&&e%c==b&&d.push(a[e]);return d}}),app.filter("postsCategoriesFilter",function(){return function(a,b){var c=b.filter(function(a){return a.picked});if(!c[0])return a;for(var d=[],e=0;e<a.length;e++)console.log(a[e],c),a[e]&&c.filter(function(b){return a[e].categories[b.name]})[0]&&d.push(a[e]);return d}}),app.filter("hostnameFromUrl",function(){return function(a){return a?("object"==typeof a&&(a=JSON.stringify(a)),a.replace(/^(.*\/\/[^\/?#]*).*$/,"$1").replace(/.*?:\/\//g,"")):a}}),app.filter("momentXFilter",function(){return function(a){return a?moment(a).format("DD-MM-YYYY HH:mm"):""}}),app.filter("fbPostsDateFilter",function(){return function(a,b){if(!b)return a;for(var c=[],d=0;d<a.length;d++)moment(a[d].created_time).isAfter(b)&&c.push(a[d]);return c}}),app.filter("fbPostsTypeFilter",function(){return function(a,b){if(!b||"Wszystkie"===b)return a;for(var c=[],d=0;d<a.length;d++)a[d].status_type===b&&c.push(a[d]);return c}});